#!/usr/bin/env python
# coding: utf-8

# In[1]:


import safenet
safenet.setup_logger(file_level=safenet.log_util.WARNING)
myApp = safenet.App()
myAuth_,addData=safenet.safe_utils.AuthReq(myApp.ffi_app.NULL,0,0,id=b'crappy_chat_reloaded',scope=b'noScope'
                       ,name=b'i_love_it',vendor=b'no_vendor',app_container=True,ffi=myApp.ffi_app)


# In[2]:


grantedAuth='bAEAAAAD62UZNEAAAAAAAAAAAAAQAAAAAAAAAAACFM4G76PMYZS2KOPD3YEWR43VSNJBRGFGEDNHR3T3RC3Q72NOCTIQAAAAAAAAAAABR3MK54Q7UYXBG6N6SAVPDMEM5WYXV3ANLM7RALFLHQVAOTLM5KEQAAAAAAAAAAABJU6XLSJULM44QZ5XMMFJVT33AVG4RQU3VRU7MGRMEYYXLTA4FHBAAAAAAAAAAAAG5NL5ZKYC42NT6LFGXJXIOUOOKSHSXKZI6EFMJPWFQHZZKWKDE24U2PLVZE2FWOOIM63WGCU2Z55QKTOIYKN2Y2PWDIWCMMLVZQOCTQIAAAAAAAAAAAAPYH4S2EZH7ZEMJVRS3RXNNOD3H2BSOY6OZ5F7P7FDFSWUDUHARCIAAAAAAAAAAACAAIT6E234RSHCPS5XAT25JJY52RTOJRK7YCBXFENUJGOAEIY2ZWGIAAAAAAAAAAAIAAAAAAAAAAABRG44C4NRSFY3TMLRYHI2TIOBTCMAAAAAAAAAAAMJTHAXDMOBOGE4DKLRSGE4DUNJUHAZREAAAAAAAAAAAGEZTQLRWHAXDCOBRFY2TOORVGQ4DGEQAAAAAAAAAAAYTGOBOGY4C4MJYGEXDMMB2GU2DQMYSAAAAAAAAAAADCMZYFY3DQLRRHAYS4OBWHI2TIOBTCIAAAAAAAAAAAMJTHAXDMOBOGE4DCLRYG45DKNBYGMJQAAAAAAAAAABRGM4C4NRYFYYTQMJOGE3DQORVGQ4DGEYAAAAAAAAAAAYTGOBOGY4C4MJYGEXDCNZWHI2TIOBTCMAAAAAAAAAAAMJTHAXDMOBOGE4DCLRRG44TUNJUHAZRGAAAAAAAAAAAGEZTQLRWHAXDCOBRFYYTQMB2GU2DQMYTAAAAAAAAAAADCMZYFY3DQLRRHAYS4MJYGI5DKNBYGMJQAAAAAAAAAABRGM4C4NRYFYYTQMJOGI2DEORVGQ4DGEYAAAAAAAAAAAYTGOBOGY4C4MJYGEXDENBTHI2TIOBTCMAAAAAAAAAAAMJTHAXDMOBOGE4DCLRSGQ4TUNJUHAZREAAAAAAAAAAAGEZTQLRWHAXDCOBZFYYTIORVGQ4DGEQAAAAAAAAAAAYTGOBOGY4C4MJYHEXDCNJ2GU2DQMYSAAAAAAAAAAADCMZYFY3DQLRRHA4S4MJXHI2TIOBTCIAAAAAAAAAAAMJTHAXDMOBOGE4DSLRRHA5DKNBYGMJAAAAAAAAAAABRGM4C4NRYFYYTQOJOGE4TUNJUHAZREAAAAAAAAAAAGEZTQLRWHAXDCOBZFYZTCORVGQ4DGEQAAAAAAAAAAAYTGOBOGY4C4MJYHEXDGNB2GU2DQMYSAAAAAAAAAAADCMZYFY3DQLRRHA4S4MZWHI2TIOBTCIAAAAAAAAAAAMJTHAXDMOBOGE4DSLRTHA5DKNBYGMJAAAAAAAAAAABRGM4C4NRYFYYTQOJOGM4TUNJUHAZRCAAAAAAAAAAAGQ3C4MJQGEXDKLRRG44TUNJUHAZQC2YVAAAAAAAAAEDQAAAAAAAAAADBNRYGQYK7GIAPAHOENG5THQBVGSK3554IYIF3MAONRIPDJN4ZICM5OWGJDOPMONMYHIAAAAAAAAABQAAAAAAAAAAAGGIDH6CXHLRIPMUGZJITFSNSQ5PCDSDQTOP36TQBAAAAAAAAAAABSAAAAAAAAAAAMFYHA4ZPMNZGC4DQPFPWG2DBORPXEZLMN5QWIZLELKPZZ3KT4VFYSUGS4GDV3PPOFZEXPBBW6PH7QG2CEBOFLVPHKRXJQOQAAAAAAAAAAEQAAAAAAAAAAAH23JQPFECHYMFI27NFONF2W4TGLYTQBKPFZB47Q6YUK6HCVLQ7Q4MAAAAAAAAAAAB6TYQR23ZWCQF2OBUF42SA32JZGUUAKX6AMH4POAAFAAAAAAAAAAAAAAAAAAAQAAAAAIAAAAADAAAAABAAAAAAA'


# In[3]:


myApp.setup_app(myAuth_,grantedAuth)


# In[4]:


myMutable = myApp.mData()


# In[5]:


mutableBytes = b'\x97Y\x85\x9b\xf9\x07U\xeb-\x8a$k|\x02*qR\x01\x16\xd5~\xfde\x9f\x1cd\x9f\xb8\xa5\x98\xf0^\t\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00/\xe3G\x7f\x00\x00'


# In[6]:


infoData= safenet.safe_utils.getffiMutable(mutableBytes,myMutable.ffi_app)


# In[ ]:





# In[22]:


userName = input('choose a username: ')
if userName == '':
    userName = 'anon'


# In[7]:


def getNewEntries(lastState,newState):
    newEntries = {}
    for additional in [item for item in newState if item not in lastState]:
        newEntries[additional]=newState[additional]
    return newEntries, newState


# In[8]:


lastState={}


# In[30]:


def printStuff(lastState):
    for item in lastState:
        print(f'{item.decode()}: {lastState[item].decode()}')
    


# In[25]:


import datetime


# In[37]:


newMessage=None


# In[38]:


while newMessage != 'exit':
    additionalEntries, lastState = getNewEntries(lastState,myMutable.getCurrentState(infoData))
    printStuff(lastState)
    newMessage = input('[your message (enter exit to leave)]: ')
    
    if newMessage and newMessage.lower() != 'exit':
        now = datetime.datetime.utcnow().strftime('%Y-%m-%d - %H:%M:%S')
        myName = userName
        text = newMessage
        timeUser = f'{now} {myName}'
        additionalEntries={timeUser:text}
        myMutable.insertEntries(infoData,additionalEntries)


# In[ ]:




